- name: "Read json files identities"
  slurp:
    src: "{{ item }}"
  loop:
    - "{{ network.org_name }}admin.json"
    - "{{ network.ca_name }}admin.json"
  register: admin_json_result

- set_fact:
    admin_identity_json: 
      data: "{{admin_json_result.results[0].content | b64decode | from_json }}"
      id: "{{ network.org_name }}-org-admin"

- name: "Store org admin identity"
  include_tasks: "store-admin-identity.yml"

- set_fact:
    admin_identity_json: 
      data: "{{admin_json_result.results[1].content | b64decode | from_json }}"
      id: "{{ network.org_name }}-ca-admin"

- name: "Store ca admin identity"
  include_tasks: "store-admin-identity.yml"

# cleanup
- name: "Cleanup files"
  file:
    state: absent
    path: "{{item}}"
  with_items:
    - "{{network.org_name}}admin.json"
    - "{{network.ca_name}}admin.json"
